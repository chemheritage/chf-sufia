<%# The image viewer, contained in a partial. Might later change this to
    some kind of JS templates or other fancy JS, instead of just server-side
    HTML all pre-rendered invisible on page like it is now.

    local args:
      * work
 %>
<div id="chf-image-viewer-modal" class="modal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-body">
        <div id= "chf-image-viewer" class="chf-image-viewer">
          <div class="viewer-header">

            <%= link_to main_app.root_path do %>
              <%= image_tag "chf_logo_white.svg", class: "chf-logo" %>
            <% end %>

            <h1>
              <a data-trigger="chf_image_viewer_close" href="#"><%= work.title.first %></a>
            </h1>

            <a href="#" data-trigger="chf_image_viewer_close" class="header-close">
              <i class="fa fa-times"></i>
            </a>
          </div>

          <div class="viewer-content">

            <div class="viewer-image-and-navbar">
              <div class="viewer-image" id="openseadragon-container">
                <button href="#" id="viewer-left" class="viewer-image-prev" data-trigger="viewer-prev" tabindex="0"><i class="fa fa-chevron-left" title="Previous"></i></button>
                <button href="#" id="viewer-right" class="viewer-image-next" data-trigger="viewer-next" tabindex="0"><i class="fa fa-chevron-right" title="Next"></i></button>
              </div>

              <%= render "chf_image_viewer_navbar", work: work %>
            </div>

            <%= content_tag "div", id:"viewer-thumbs", class: "viewer-thumbs", data: { total_count: work.viewable_member_presenters.count } do %>
              <% work.viewable_member_presenters.each_with_index do |member_presenter, i| -%>
                <%= tag "img",
                    class: "lazyload viewer-thumb-img",
                    alt: "",
                    tabindex: "0",
                    role: "button",
                    data: {
                      aspectratio: "#{member_presenter.representative_width}/#{member_presenter.representative_height}", # used for lazysizes-aspectratio
                      trigger: 'change-viewer-source',
                      index: i + 1,
                      title: member_presenter.link_name,
                      member_should_show_info: member_presenter.model_name.to_s != "FileSet",
                      member_id: member_presenter.representative_id,
                      member_show_url: contextual_path(member_presenter, work),
                      member_dl_original_url: main_app.download_path(member_presenter.representative_id),
                      member_dl_jpeg_url: (if CHF::Env.lookup(:use_image_server_downloads)
                                            riiif_image_url(member_presenter.riiif_file_id, format: "jpg", size: "full")
                                          end),
                      tile_source: (if CHF::Env.lookup(:use_image_server_on_viewer)
                                      # TODO this needs to be config switch between riiif/IIIF and imgix
                                      #riiif_info_url(member_presenter.riiif_file_id)
                                      {
                                         "type" => "imgix",
                                         "baseUrl" => imgix_url(member_presenter.id),
                                         "height" => member_presenter.representative_height,
                                         "width" => member_presenter.representative_width
                                      }.to_json
                                    else
                                      {"type" => "image", "url" => main_app.download_path(member_presenter.representative_id, file: "jpeg")}.to_json
                                    end),
                      src: member_presenter.first(blacklight_config.view_config(document_index_view_type).thumbnail_field)
                    } if member_presenter.riiif_file_id # don't show it in the viewer if there's no image
                -%>
              <%- end -%>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
