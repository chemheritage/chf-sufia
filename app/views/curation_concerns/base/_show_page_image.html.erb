<%# CHF custom, an image with overlaid controls and info. Used as an alternative to
    `representative_media` for show page, as well as for page thumbs on show page %>
<%= content_tag("div",
      tabindex: "0",
      data: {
        trigger: "chf_image_viewer",
        parent_id: @presenter.id,
        member_id: member.representative_id
      },
      class: ["show-page-image"] + Array(local_assigns[:extra_classes])) do
%>
    <% if local_assigns[:lazy_after] && member_counter > local_assigns[:lazy_after] - 1 %>
      <%= image_tag nil,
                    class: "lazyload show-page-image-image",
                    alt: "",
                    data: {
                      src: main_app.download_path(member.representative_id, file: "jpeg")
                    }
      %>
    <% else %>
      <%= image_tag main_app.download_path(member.representative_id, file: "jpeg"),
                    class: "show-page-image-image",
                    alt: "",
                    data: {
                      trigger: "chf_image_viewer",
                      parent_id: @presenter.id,
                      member_id: member.id
                    }
      %>
    <% end %>

    <% if current_ability.current_user.staff? || member.model_name.singular.to_sym != :file_set %>
      <div class="show-page-member-title">
        <%= member.title.first %>
      </div>
    <% end %>

    <div class="show-page-image-permission">
      <% if member.needs_permission_badge? %>
        <%= member.permission_badge %>
      <% end %>
    </div>

    <div class="show-page-image-bar">
      <% if (member.model_name.singular.to_sym == :file_set) && can?(:read, member.id) %>
        <div class="btn-group dropup">
          <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <%# less space for admin, just use icon %>
            <i class='fa fa-download'></i> <% if ! current_ability.current_user.staff? %> Download <% end %>
          </button>
          <ul class="dropdown-menu">
            <% if @presenter.has_rights_statement? %>
              <li><%= render 'rights_statement', presenter: @presenter, theme: 'inline' %></li>
              <li class="divider"></li>
            <% end %>
            <li>
              <%= link_to main_app.download_path(member.representative_id),
                          target: "_new",
                          id: "file_download",
                          data: {
                            label: member.id,
                            # These action/labels are what sufia/hyrax uses, although
                            # a bit weird. https://github.com/samvera/hyrax/blob/1e504c200fd9c39120f514ac33cd42cd843de9fa/app/assets/javascripts/hyrax/ga_events.js
                            analytics_category: "Work",
                            analytics_action: "download-tiff",
                            analytics_label: @presenter.id
                          } do %>
                  Original Image
              <% end %>
            </li>
            <li class="divider"></li>
            <li><a>More download options coming</a></li>
          </ul>
        </div>
      <% end %>

      <% if (member.model_name.singular.to_sym == :file_set) && current_ability.current_user.staff? %>
        <%= render "show_page_image_file_set_actions", file_set: member, presenter: @presenter %>
      <% elsif member.model_name.singular.to_sym != :file_set %>
        <%= link_to "Info", contextual_path(member, @presenter), class: "btn btn-primary show-page-image-info" %>
      <% end %>

    </div>
<% end %>



