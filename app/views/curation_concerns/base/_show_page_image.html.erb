<%# CHF custom, an image with overlaid controls and info. Used as an alternative to
    `representative_media` for show page, as well as for page thumbs on show page

    Locals:
      * size: :large (used for big hero image) or :medium used for subsequent
        page images. Default :medium
      * lazy_after: optional. used when this is used as a collection partial, make images
          lazy loading after the first N images, where N is the lazy_after value.
      * extra_classes: optional. extra CSS calsses added to the wrapper <div> tag.

%>
<%
   # this was just derived from just looking in the browser at our present
   # CSS, what's the widest the 'large' and 'medium' images can be at
   # any responsive CSS?
   base_width = local_assigns[:size] == :large ? 525 : 208
%>
<%= content_tag("div",
      tabindex: "0",
      class: ["show-page-image"] + Array(local_assigns[:extra_classes])) do
%>

    <%= member_image_tag(parent_id: @presenter.id, member: member,
                         size_key: local_assigns[:size],
                         lazy: (local_assigns[:lazy_after] && member_counter > local_assigns[:lazy_after] - 1))
    %>

    <% if current_ability.current_user.staff? || member.model_name.singular.to_sym != :file_set %>
      <div class="show-page-member-title">
        <%= member.title.first %>
      </div>
    <% end %>

    <div class="show-page-image-permission">
      <% if member.needs_permission_badge? %>
        <%= member.permission_badge %>
      <% end %>
    </div>

    <div class="show-page-image-bar">
      <% if (member.model_name.singular.to_sym == :file_set) && can?(:read, member.id) %>
        <div class="btn-group dropup">
          <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <%# less space for admin, just use icon %>
            <i class='fa fa-download'></i> <% if ! current_ability.current_user.staff? %> Download <% end %>
          </button>
          <%= member_download_menu(member, parent: @presenter) %>
        </div>

      <% end %>

      <% if (member.model_name.singular.to_sym == :file_set) && current_ability.current_user.staff? %>
        <div class="btn-group dropup">
          <button class="btn btn-primary dropdown-toggle" data-toggle="dropdown" type="button" id="dropdownMenu_actions_<%= member.id %>" aria-haspopup="true">
            Admin
          </button>
          <%= file_set_actions_menu(member, parent: @presenter, labelled_by: "dropdownMenu_actions_#{member.id}" ) %>
        </div>
      <% elsif member.model_name.singular.to_sym != :file_set %>
        <%= link_to "Info", contextual_path(member, @presenter), class: "btn btn-primary show-page-image-info" %>
      <% end %>

    </div>
<% end %>



